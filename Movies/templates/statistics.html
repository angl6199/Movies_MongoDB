{% extends 'layout.html' %}

{% block extralinks %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
{% endblock %}

{% block options %}
<a href="{% url 'movies' %}" class="d-flex align-items-center text-light p-3">
    <i class="bi bi-camera-video-fill me-2"></i><span class="fs-6 ms-1">Custom search</span>
</a>
<a href="{% url 'statistics' %}" class="d-flex align-items-center text-light p-3">
    <i class="bi bi-bar-chart-fill me-2 sel"></i><span class="fs-6 ms-1 sel">Statistics</span>
</a>
{% endblock %}

{% block topbar %}
<form class="d-flex" action="" method="GET">
    <div id="select-container" class="d-flex input-group ms-5 me-4">
        <label class="input-group-text" for="search-fields">Search category</label>
        <select class="form-select inside-focus" name="search-fields" id="search-fields">
            <option value="Choose one...">Choose one...</option>
            <option value="Country">Country</option>
            <option value="Release year">Release year</option>
        </select>
    </div>
    <div id="search-input-container" class="input-group ms-5">
        <input type="text" id="search-input" name="search-input" class="form-control bg-light border-0 small inside-focus" placeholder="Search...">
        <div class="input-group-append">
            <button class="btn btn-primary" type="submit">
                <i class="bi bi-search"></i>
            </button>
        </div>
    </div>
</form>
{% endblock %}

{% block content %}
    {% if validar %}
        {% if category == "Choose one..." or searched_input is None %}
            <div class="card statistics-card card mx-auto my-4 border-0 shadow-sm">
                <h5 class="card-header">Netflix Content <i class="ms-1 bi bi-file-bar-graph"></i></h5>
                <div class="card-body d-flex flex-row">
                    <div>
                        <h5 class="card-title">Movies vs TV Shows</h5>
                        <p class="card-text">Kaggle's Netflix database data:</p>
                        <span class="">- {{l1}} : {{n1}}</span><br>
                        <span class="">- {{l2}} : {{n2}}</span>
                    <hr style = "height : 2px;color:var(--primary)">
                    </div>
                    <div class="ms-5">
                    <canvas height="" width="" class="mt-3" id="myChart" ></canvas>
                    </div>
                </div>
            </div>
        {% elif category == "Country" %}
        <div class="card statistics-card card mx-auto my-4 border-0 shadow-sm">
            <h5 class="card-header">Movies of a given country <i class="ms-1 bi bi-file-bar-graph"></i></h5>
            <div class="card-body d-flex flex-row">
                <div>
                    <h5 class="card-title">Movies in: {{searched_input}}</h5>
                    <p class="card-text">Kaggle's Netflix database data:</p>
                    <span class="">- {{l1}} : {{n1}}</span><br>
                    <span class="">- {{l2}} : {{n2}}</span>
                <hr style = "height : 2px;color:var(--primary)">
                </div>
                <div class="ms-5">
                <canvas height="" width="" class="mt-3" id="myChart" ></canvas>
                </div>
            </div>
        </div>
        {% elif category == "Release year" %}
        <div class="card statistics-card card mx-auto my-4 border-0 shadow-sm">
            <h5 class="card-header">TV Shows of a given year <i class="ms-1 bi bi-file-bar-graph"></i></h5>
            <div class="card-body d-flex flex-row">
                <div>
                    <h5 class="card-title">TV Shows released in: {{searched_input}}</h5>
                    <p class="card-text">Kaggle's Netflix database data:</p>
                    <span class="">- {{l1}} : {{n1}}</span><br>
                    <span class="">- {{l2}} : {{n2}}</span>
                <hr style = "height : 2px;color:var(--primary)">
                </div>
                <div class="ms-5">
                <canvas height="" width="" class="mt-3" id="myChart" ></canvas>
                </div>
            </div>
        </div>
        {% endif %}
        
    {% elif not validar %}
        {% if category == "Country" %}
            <div class="card my-4 border-0 shadow-sm error-card">
            <h5 class="card-header">Movies of a given country</h5>
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-eye-slash-fill me-2"></i>No match for: {{searched_input}}</h5>
                    <p class="card-text">There are no Movies in the country {{searched_input}} in Kaggle's Netflix database.</p>
                </div>
            </div>
        {% elif category == "Release year" %}
            <div class="card my-4 border-0 shadow-sm error-card">
            <h5 class="card-header">TV Shows of a given year</h5>
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-eye-slash-fill me-2"></i>No match for: {{searched_input}}</h5>
                    <p class="card-text">There are no TV shows released in {{searched_input}} in Kaggle's Netflix database.</p>
                </div>
            </div>
        {% endif %}
    {% endif %}


{% endblock %}

{% block extrajs %}
<script type="text/javascript" src="https://cdnjs.com/libraries/Chart.js"></script>
<script type="text/javascript">
    console.log('{{validar}}')
    console.log('{{n1}}')
    console.log('{{searched_input}}')
    var n1 = parseInt("{{n1}}", 10);
    var n2 = parseInt("{{n2}}", 10);
    const data = {
            labels: [
                '{{l1}}',
                '{{l2}}',
            ],
            datasets: [{
                label: 'My First Dataset',
                data: [n1, n2],
                backgroundColor: [
                'rgb(229, 9, 20)',
                'rgb(117, 5, 10)'
                ],
                hoverOffset: 4
            }]
    };
    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'doughnut',
        data: data,
    });
</script>
{% endblock %}